<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Employee</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

      <link rel="stylesheet" href="css/style.css">
  <style>
  .ng-valid{
        border:1px solid rgb(92,184,92);
    }
    
</style>
 
</head>
<body ng-app="myApp" ng-controller="myControl">

<div style="background:rgba(225,225,225,0.5);position:absolute; width: 100%;height: 100%;z-index: 99;display: none" id="loading" >
  
    <img src="loading.gif" width="100%" style="position: absolute;z-index: 999;top: 0;right: 0;bottom: 0;left: 0;">
</div>

<form name="form" class="needs-validation">
<div class="tabs">
  
   
  <input type="radio" id="tab1" name="tab-control" checked>
  <input type="radio" id="tab2" name="tab-control">
  <input type="radio" id="tab3" name="tab-control">  
  <input type="radio" id="tab4" name="tab-control">
  <ul style="/*width:500px*/; background-color:#222; line-height: 40px;">
    <li><label for="tab1" role="button"></svg><br><span>Employee</span></label></li>
<!--     <li><label for="tab2" role="button"></svg><br><span>Documents</span></label></li>
    <li><label for="tab3" role="button"></svg><br><span>Notes</span></label></li>    
  <li><label for="tab4" role="button"></svg><br><span style="margin-right: 20px;">History</span></label></li> -->
  <li><label for="tab1" role="button"></svg><br><span></span></label></li>
    <li><label for="tab2" role="button"></svg><br><span></span></label></li>
    <li><label for="tab3" role="button"></svg><br><span></span></label></li>    
  <li><label for="tab4" role="button"></svg><br><span></span></label></li>
  <li><label for="tab1" role="button"></svg><br><span></span></label></li>
    <li><label for="tab2" role="button"></svg><br><span></span></label></li>
    <li><label for="tab3" role="button"></svg><br><span></span></label></li>    
  <li><label for="tab4" role="button"></svg><br><span></span></label></li> 
  <li > <button type="button" class="close clo " data-dismiss="modal" style="color: #ffff;margin-right: 20px;margin-bottom:10px ;font-size:35px " >&times;</button></li>
  </ul>
  <div class="slider"><div class="indicator"></div></div>
  <div class="content">
    <section>

     <div class="container-fluid jumbotron mappfull" style="margin-top:-30px "><!--Start of container fluid-->
     	<div class="row"><!-- satart of row -->

     		<div class="col-sm-3">
     			<div class="col-sm-6 "><label class="">Id<span style="color:red;">*</span></label><input type="text" name="id" class="form-control" placeholder="Enter Id" ng-model="emp.id" ng-required="true" />
            <div ng-show="form.$submitted || form.id.$touched">
                <span style="color:orange" ng-show="form.id.$error.required"> Please enter Id</span>
            </div>
          </div>

     			<div class="col-sm-6">
     				<label class="">Gender<span style="color:red;">*</span></label>
     				<select class="form-control" ng-model="emp.gender" name="gender" ng-required="true">
     					<option value="" readonly>select gender</option>
     					<option value="M">Male</option>
     					<option value="F">Female</option>
     				</select>

                 <div ng-show="form.$submitted || form.gender.$touched">
                <span style="color:orange" ng-show="form.gender.$error.required"> Please Select Gender</span>
                  </div>

     			</div><!-- End of col-6 -->
     		</div><!-- End of col-3 -->

     		<div class="col-sm-9"><!-- Start of col-9 -->
     		<div class="col-sm-4">
     			<label class="">First Name<span style="color:red;">*</span></label>
     			<input  only-letters-input type="text"  placeholder="Enter First Name" class="form-control" ng-model="emp.firstName" name="fname" ng-required="true">

             <div ng-show="form.$submitted || form.fname.$touched">
                <span style="color:orange" ng-show="form.fname.$error.required"> Please Enter First Name</span>
               </div>

     		</div>
     		<div class="col-sm-4">
     			<label class="">Middle Name</label>
     			<input only-letters-input type="text"  placeholder="Enter Middle Name" class="form-control" ng-model="emp.middleName" name="mname" >
     		</div>
     		<div class="col-sm-4">
     			<label class="">Last Name<span style="color:red;">*</span></label>
     			<input only-letters-input  type="text"  placeholder="Enter Last Name" class="form-control" ng-model="emp.lastName" name="lname" ng-required="true">

              <div ng-show="form.$submitted || form.lname.$touched">
                <span style="color:orange" ng-show="form.lname.$error.required"> Please Enter Last Name</span>
               </div>

     		</div>
     		</div><!-- End of col-9 -->
     	</div><!-- End of 1st row -->


     	<div class="row"><!-- Strat of 2nd row -->

     		<div class="col-sm-12">
     			


     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">Date Of Birth<span style="color:red;">*</span></label>
     			<input class="form-control dep_date"  placeholder="Enter Date" type="date" Id="startdate" name="dateOfBirth" ng-model="emp.dateOfBirth" max="{{getDateForBirth}}" ng-change="setDate(emp.dateOfBirth)" ng-required="true" />

               <div ng-show="form.$submitted || form.dateOfBirth.$touched">
                <span style="color:orange" ng-show="form.dateOfBirth.$error.required"> Please Date of Birth</span>
               </div>

     			</div>

          <div class="col-sm-3">
            <!-- <br> -->
          <label class="">Date Of Joining<span style="color:red;">*</span></label>
          <input class="form-control dep_date"  placeholder="Enter Date Of Joining" type="date" Id="startdate"  ng-model="emp.dateOfJoining" name="dateOfJoining" min="{{setDateofJoining}}" ng-change="setDateJoin(emp.dateOfJoining)" ng-required="true" />

                <div ng-show="form.$submitted || form.dateOfJoining.$touched">
                <span style="color:orange" ng-show="form.dateOfJoining.$error.required" > Please Date of joining</span>
               </div>

          </div>


     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">Status<span style="color:red;">*</span></label>
     			<input type="text" name="status" placeholder="Enter Status" class="form-control" ng-model="emp.status" ng-required="true" >

             <div ng-show="form.$submitted || form.status.$touched">
                <span style="color:orange" ng-show="form.status.$error.required"> Please Enter status</span>
               </div>

     			</div>

     		</div><!-- End of col-12 -->
     		
     	</div><!-- End of 2nd row -->

     </div><!-- End of container fluid -->


     <div class="container-fluid jumbotron mappfull" ><!-- Start of 2nd continer fluid -->
     	<div class="row"><!-- Start of 1st row -->

     		<div class="col-sm-12"><!-- start of col-12 -->

     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">Company<span style="color:red;">*</span></label>
     			<select class="form-control" ng-model="emp.cmpnyId" ng-change="companyLink(emp.cmpnyId)" name="cmpnyId" ng-required="true">
            <option value="" readonly>Select Company</option>
            <option ng-repeat="x in companyData" value="{{x}}" >{{x.company}}</option>
          </select>


               <div ng-show="form.$submitted || form.cmpnyId.$touched">
                <span style="color:orange" ng-show="form.cmpnyId.$error.required"> Please Select company</span>
               </div>

     			</div>
     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">Business unit<span style="color:red;">*</span></label>
     			<select class="form-control" ng-model="emp.buId" name="businessunits" ng-required="true">
            <option value="" readonly>Select Business Unit</option>

            <option ng-repeat="y in businessDataLink" value={{y.id}}>{{y.name}}</option>
          </select>


               <div ng-show="form.$submitted || form.businessunits.$touched">
                <span style="color:orange" ng-show="form.businessunits.$error.required"> Please Select company</span>
               </div>

     			</div>
     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">Department<span style="color:red;">*</span></label>
     			<select class="form-control" ng-model="emp.deptId" name="deptId" ng-required="true">
            <option value="" readonly>Select Department</option>
            <option ng-repeat="z in depDataLink" value="{{z.id}}">{{z.name}}</option>
          </select>

          <div ng-show="form.$submitted || form.deptId.$touched">
                <span style="color:orange" ng-show="form.deptId.$error.required"> Please Select company</span>
               </div>

     			</div>

     		</div><!-- End col-12 -->


     		<div class="col-sm-12"><!-- Start col 12 -->
     			<div class="col-sm-3">
     				<!-- <br> -->
     			<label class="">designation<span style="color:red;">*</span></label>
     			<input type="text" name="designation" placeholder="Enter Designation" class="form-control" ng-model="emp.designation" ng-required="true" >
     			
                <div ng-show="form.$submitted || form.designation.$touched">
                <span style="color:orange" ng-show="form.designation.$error.required"> Please Select Desigation </span>
               </div>

          </div>

          <div class="col-sm-3">
     			<!-- 	<br> -->
     			<label class="">Report To<span style="color:red;">*</span></label>
     			<select class="form-control" ng-model="emp.reportTo" name="reportTo" >
            <option value="" readonly>Select Report to</option>
            <option ng-repeat="m in getAllManager" value="{{m.employeeId}}">{{m.firstName}}</option>
          </select>
          <!--  <div ng-show="form.$submitted || form.reportTo.$touched">
                <span style="color:orange" ng-show="form.reportTo.$error.required"> Please Select Report to </span>
               </div> -->

     			</div>

          <div class="col-sm-3">
     			<!-- 	<br> -->
     			<label class="">User Id<span style="color:red;">*</span></label>
     			<input type="text" name="userId" placeholder="Enter User Id"  class="form-control" ng-model="emp.employeeId" countr ng-required="true">

                 <span style="color:black;" ng-show="form.userId.$pending.countr">Checking ....</span>
        <span style="color:orange;" ng-show="form.userId.$error.countr">Already exists, try another</span>

                <div ng-show="form.$submitted || form.userId.$touched">
                <span style="color:orange" ng-show="form.userId.$error.required"> Please Enter UserId </span>
               </div>
     			</div>

          <div class="col-sm-3">
     			<!-- 	<br> -->
     			<label class="">Email<span style="color:red;">*</span></label>
     		<!-- 	<input type="email" name="emailId"  ng-model="emp.emailId" country  > -->
        <input type="email" name="emailId" placeholder="Enter Email" class="form-control" ng-model="emp.emailId" country ng-required="true"/>
     			       <span style="color:black;" ng-show="form.emailId.$pending.country">Checking ....</span>
        <span style="color:orange;" ng-show="form.emailId.$error.country">Already exists, try another</span>


              <div ng-show="form.$submitted || form.emailId.$touched">
                <span style="color:orange" ng-show="form.emailId.$error.required"> Please Enter EmailId </span>
              <span style="color:orange" class="error" ng-show="form.emailId.$error.email">Not valid email!</span>
               </div>
               
             

               <!--  <ul class="error-msgs" ng-messages="form.emailId.$error">
        
        <li ng-message="uppercaseValidator">Strong secret has to contain at least 1 uppercase</li>
            </ul> -->

          </div>
     		</div><!-- End col 12 -->
     	</div><!-- End of 1st row -->
     </div><!-- End of 2nd container fluid -->


 <div class="container-fluid jumbotron mappfull" ><!-- Start of 3rd container fluid -->
  <div class="row">
        <div class="col-sm-12"><!-- Start of col-12 -->
          <div class="col-sm-3">
            <label>Process Roles</label>
            <select class="form-control" ng-model="selProcessRoles" name="selProcessRoles"  ng-change=processRolesChange(selProcessRoles)>
              <option value="">Select Process Roles</option>
              <option ng-repeat="x in processRoles" value="{{x}}" ng-disabled="rolesName.includes(x.id)">{{x.id}}</option>
            </select>
                <!-- <div ng-show="form.$submitted || form.selProcessRoles.$touched">
                <span style="color:orange" ng-show="form.selProcessRoles.$error.required"> Please Select Process Roles </span>
               </div> -->
          </div>

          <div class="col-sm-3">
            <label>User Roles</label>
            <select class="form-control" ng-model="selUserRoles" name="selUserRoles"  ng-change=userRolesChange(selUserRoles)>
              <option value="">Select User Roles</option>
              <option ng-repeat="x in userRoles" value="{{x}}" ng-disabled="rolesName.includes(x.id)">{{x.id}}</option>
            </select>
           <!--  <div ng-show="form.$submitted || form.selUserRoles.$touched">
                <span style="color:orange" ng-show="form.selUserRoles.$error.required"> Please Select User ROles </span>
               </div> -->
          </div>

          <div class="col-sm-4">
            <label>Assigned Roles</label>
             <!--  <div class="list-group">
              <a href="#" class="list-group-item" ng-repeat="x in roleShow">{{x.name}}<a class="glyphicon glyphicon-remove text-right"></a></a>
            </div> -->
            
            <div  class="col-sm-12" ng-repeat="x in roleShow" style="margin-bottom: 3px">
            
            <div class="input-group">
             <input type="text" class="form-control" name="" value="{{x.id}}" style="border-right: none;background: #fff" readonly>
             <span class="input-group-addon" style="background: #fff;border-left: none" ng-click="closeAssignRoles(x)">&times;</span>
           </div>
            </div>
          </div><!-- End of col-6 -->

        </div><!-- End of col-12 -->
  </div><!-- End of row -->
</div><!-- End of 3rd container fluid -->



      <div class="container-fluid jumbotron fontSize">
          <div class="row">
          <div class="col-sm-6"></div>
          <div class="col-sm-6">
            
             <button id="sub" type="button" class="form-control btn-success pull-right" ng-disabled="form.$invalid" style="margin-top:0px; margin-bottom: 20px; width:100px;margin-right: 30px; " align="center" type="button" ng-click="sub()" >Submit</button>
            <button  type="button" id="close" class="form-control   pull-right btn btn-primary clo"  style="margin-top:0px; margin-bottom: 20px; width:100px;margin-right: 40px;  " align="center" >Cancel</button>

          
           
            
          </div>
          </div>
        </div>


    </section>





        <section>  <!--Documents Tab -->
          <div class="document">
        </div>
        </section>

        <section><!--Notes Tab Start-->
         <div class="notes">
        </div>
        </section>
        
        <section>
        <div class="history">
        </div>
        </section><!--End of history-->
    
  </div>
</div>



<div id="errormsg"  style="color:red; text-align: center; font-size: 25px;"></div>
</form>


<div class="message"></div>









<script type="text/javascript">
           
$(".clo").click(function(){
//  alert("going to close");
  window.parent.closeModal();
});
        
function split_key(key)
{
  var arr=[];
  var temp=key.split("&");
  for(var i=0;i<temp.length;i++)
    {
     var key=temp[i].split("=");
     arr.push(key[1]);
    }
 
  return arr;
}
var url_loc=decodeURIComponent(window.location.search);
var arr=split_key(url_loc);

var sessionId=arr[0];



  $(".document").load("html/document.html");
$(".notes").load("html/notes.html");
$(".history").load("html/history.html");
$(".message").load("html/messageAlert.html");

angular.module('myApp', [])
  .controller('myControl', function($scope,$http,$q) {



 $scope.todayDate=function() {
    var today = new Date(); // get the current date
    var dd = today.getDate(); //get the day from today.
    var mm = today.getMonth()+1; //get the month from today +1 because january is 0!
    var yyyy = today.getFullYear(); //get the year from today
    //if day is below 10, add a zero before (ex: 9 -> 09)
    if(dd<10) {
        dd='0'+dd
    }
    //like the day, do the same to month (3->03)
    if(mm<10) {
        mm='0'+mm
    }
    //finally join yyyy mm and dd with a "-" between then
    return yyyy+'-'+mm+'-'+dd;
}
$scope.getTodayDate=$scope.todayDate();


 $scope.birthDate=function() {
    var today = new Date(); // get the current date
    var dd = today.getDate(); //get the day from today.
    var mm = today.getMonth()+1; //get the month from today +1 because january is 0!
    var yyyy = today.getFullYear(); //get the year from today
    //if day is below 10, add a zero before (ex: 9 -> 09)
    if(dd<10) {
        dd='0'+dd
    }
    //like the day, do the same to month (3->03)
    if(mm<10) {
        mm='0'+mm
    }
    //finally join yyyy mm and dd with a "-" between then
    return yyyy-18+'-'+mm+'-'+dd;
}
$scope.getDateForBirth=$scope.birthDate();


$scope.setDate=function(x){

var today=new Date(x);


var dd = today.getDate(); //get the day from today.
    var mm = today.getMonth()+1; //get the month from today +1 because january is 0!
    var yyyy = today.getFullYear(); //get the year from today
    //if day is below 10, add a zero before (ex: 9 -> 09)
    if(dd<10) {
        dd='0'+dd
    }
    //like the day, do the same to month (3->03)
    if(mm<10) {
        mm='0'+mm
    }
    //finally join yyyy mm and dd with a "-" between then
  $scope.setDateofJoining=  yyyy+18+'-'+mm+'-'+dd;
  console.log("Date is"+date);


}


$scope.setDateJoin=function(x){



if(x>$scope.todayDate())
{
  $scope.getDateForBirth=$scope.birthDate();
}
var today=new Date(x);


var dd = today.getDate(); //get the day from today.
    var mm = today.getMonth()+1; //get the month from today +1 because january is 0!
    var yyyy = today.getFullYear(); //get the year from today
    //if day is below 10, add a zero before (ex: 9 -> 09)
    if(dd<10) {
        dd='0'+dd
    }
    //like the day, do the same to month (3->03)
    if(mm<10) {
        mm='0'+mm
    }
    //finally join yyyy mm and dd with a "-" between then
  $scope.getDateForBirth=  yyyy-18+'-'+mm+'-'+dd;
  console.log("Date is Join"+date);




}



















$scope.sessionId=sessionId;
$scope.emp={};

//$scope.emp.employeeId=$scope.sessionId;
//console.log("sessionId is"+$scope.sessionId);
 $http({
        method : "GET",
        url : "/actnow-claims-1.0.0/actnow/companies"
    }).then(function mySuccess(response) {
      
        $scope.companyData=response.data;
     

        console.log("Company Data"+$scope.companyData);
    }, function myError(response) {
        console.log(response.data);
    });




    $http({
        method : "GET",
        url : "/actnow-claims-1.0.0/actnow/businessunits"
    }).then(function mySuccess(response) {
      
        $scope.busData=response.data;
        console.log($scope.busData);
    }, function myError(response) {
        console.log(response.data);
    });



    $http({
        method : "GET",
        url : "/actnow-claims-1.0.0/actnow/department"
    }).then(function mySuccess(response) {
      
        $scope.depData=response.data;
        console.log($scope.busData);
    }, function myError(response) {
        console.log(response.data);
    });

/*Start of geting process roles*/
 $http({
        method : "GET",
        url : "/actnow-claims-1.0.0/actnow/employees/processRoles"
    }).then(function mySuccess(response) {
      
        $scope.processRoles=response.data;
       // console.log( "PROCESS ROLES"+$scope.processRoles);
    }, function myError(response) {
        console.log(response.data);
    });


/*End of getting process roles*/

/*Start of geting user roles*/
 $http({
        method : "GET",
        url : "/actnow-claims-1.0.0/actnow/employees/roles"
    }).then(function mySuccess(response) {
      
        $scope.userRoles=response.data;
        //console.log( "PROCESS ROLES"+$scope.processRoles);
    }, function myError(response) {
        console.log(response.data);
    });


/*End of getting user roles*/

/*Start opertion for roles*/
$scope.processRolesInsert=[];
$scope.userRolesInsert=[];
$scope.roleShow=[];
$scope.rolesName=[];

$scope.processRolesChange=function(x){
  var dat=JSON.parse(x);
  console.log(dat);
  if (dat!=null) {
$scope.processRolesInsert.push(dat);
$scope.roleShow.push(dat);
//console.log($scope.roleShow);
$scope.rolesName.push(dat.id);
}
}


$scope.userRolesChange=function(x){
    var dat=JSON.parse(x);
    console.log(x);
    if (dat!=null) {
$scope.userRolesInsert.push(dat);
$scope.roleShow.push(dat);
$scope.rolesName.push(dat.id);
}
//console.log($scope.roleShow);
}

$scope.closeAssignRoles=function(x){
 console.log(x);

 var index=parseInt($scope.roleShow.indexOf(x));
 $scope.roleShow.splice(index,1);
 //console.log($scope.roleShow.length);
  var indexName=parseInt($scope.rolesName.indexOf(x.id));
 $scope.rolesName.splice(indexName,1);

 if($scope.processRolesInsert.includes(x))
 {
  var index=parseInt($scope.processRolesInsert.indexOf(x));
  console.log("process ROles BEFORE"+$scope.processRolesInsert.length);
$scope.processRolesInsert.splice(index,1);
 console.log("Process Roles AFTER"+$scope.processRolesInsert.length);
 }
  if($scope.userRolesInsert.includes(x))
 {
  console.log("User Roles Before"+$scope.userRolesInsert.length);
  var index=parseInt($scope.userRolesInsert.indexOf(x));
$scope.userRolesInsert.splice(index,1);
 console.log("User Roles After"+$scope.userRolesInsert.length);
 }



}





/*End operation for roles*/


$scope.comapnyDet={};
/*Start of getting bus and dep as per uuid*/
$scope.companyLink=function(x){
  $scope.getAllManager=[];
/*alert(x+"data");*/
$scope.comObj = JSON.parse(x);
$scope.comId=$scope.comObj.id;
console.log("this id is "+$scope.comId);

$scope.comUnId=$scope.comObj.uniqueId;
$scope.businessDataLink=[];
$scope.depDataLink=[];





  angular.forEach($scope.busData,function(value,key){
   if(value.uniqueId==$scope.comUnId)
   {
    $scope.businessDataLink.push(value);
   }

  });


  angular.forEach($scope.depData,function(value,key){
   if(value.uniqueId==$scope.comUnId)
   {
    $scope.depDataLink.push(value);
   }

  });

   $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"
    }).then(function mySuccess(response) {
      
      $scope.empComData=response.data;
      angular.forEach($scope.empComData,function(val,key){

          if(val.cmpnyId==$scope.comId)
          {
            console.log(val);
            $scope.getAllManager.push(val);
          }

      })

      })





}
/*End of bus and dep as per uuid*/




    /*getting manager*/
/*
     $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"+$scope.sessionId+""
    }).then(function mySuccess(response) {
      
       $scope.empGetData=response.data;
       $scope.currEmpId= $scope.empGetData.employeeId;
       $scope.currentComId=$scope.empGetData.cmpnyId;

      // console.log($scope.empGetData);
       
        $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"
    }).then(function mySuccess(response) {
      
       $scope.allEmpGetData=response.data;
       $scope.getAllManager=[];
       angular.forEach($scope.allEmpGetData,function(value,key){

        if(value.cmpnyId==$scope.currentComId && value.employeeId!=$scope.currEmpId)
        {
        //  console.log("MANAGER DETILS"+value.employeeId);
         // console.log($scope.currEmpId);
         console.log(value);
          $scope.getAllManager.push(value);

        }
        
      
       })
      // console.log($scope.empGetData);
       
    }, function myError(response) {
        console.log(response.data);
    });



    }, function myError(response) {
        console.log(response.data);
    });
*/

/*End of getting Manager*/




/*$scope.emailVerify=function(i){
  $scope.entryEmail=i;
}
$scope.emailCheck=function(){
  console.log($scope.entryEmai);
}
*/

  


$scope.sub=function(){


$scope.count=3;
$scope.empData={
       "id": $scope.emp.id,
       "gender": $scope.emp.gender,
       "firstName": $scope.emp.firstName,
       "middleName": $scope.emp.middleName+"",
       "lastName": $scope.emp.lastName,
       "dateOfJoining": $scope.emp.dateOfJoining,
       "dateOfBirth": $scope.emp.dateOfBirth,
       "status": $scope.emp.status,
       "cmpnyId": $scope.comId,
       "buId": parseInt($scope.emp.buId),
       "deptId": parseInt($scope.emp.deptId),
       "designation": $scope.emp.designation,
       "reportTo": parseInt($scope.emp.reportTo),
       "loginId": $scope.emp.employeeId,
       "emailId": $scope.emp.emailId
   }
var emppost=JSON.stringify($scope.empData, null, "\t");
/*var processRolesPost=JSON.stringify($scope.processRolesInsert, null, "\t");
var userRolesPost=JSON.stringify($scope.userRolesInsert, null, "\t");*/
console.log(emppost);

$("#loading").css("display","block");

   /*Start of post depPost*/


 $http({              
        method : "POST",
         url: "/actnow-claims-1.0.0/actnow/employees",
        data:emppost,
 headers: { 'Content-Type': 'application/json'}
       
   }).then(function mySuccess(response) {
        console.log("Success full insert emp"+response);

            $scope.successModal();

              /*Now check data is present or not*/
               $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"
    }).then(function mySuccess(response) {
    
    var cnt=0;
       angular.forEach(response.data,function(value,key){

          console.log(value.loginId);

          if(value.loginId== $scope.emp.employeeId)
          {
              cnt++;
          }
       })/*End of 1st loop*/

       if(cnt>0) /*Start of loop for process*/
       {
          console.log("present AND successfully");

           
/*Start of Process roles add*/
if($scope.processRolesInsert.length>0)
{

angular.forEach($scope.processRolesInsert,function(val,key){

  var rolesName=val.id;
  var userId=$scope.emp.employeeId;

  /*Stat of http post*/
    (function(rolesName,userId){
console.log(rolesName+" "+userId);
    var settings = {
  "async": true,
  "crossDomain": true,
  "url":"/actnow-claims-1.0.0/actnow/employees/processRoles/"+rolesName+"/"+userId+"",
  "method": "PUT",
  "headers": {
    "content-type": "application/json",
    "cache-control": "no-cache",
    
  }
}

$.ajax(settings).done(function (jqXHR, textStatus, errorThrown) {
  console.log("process Roles"+jqXHR);
  console.log("process Roles"+textStatus);
  console.log("process Roles"+errorThrown);
  $scope.successModal();
}).fail(function(jqXHR, textStatus, errorThrown){
  console.log("process Roles"+jqXHR);
  console.log("process Roles"+textStatus);
  console.log("process Roles"+errorThrown);
   $scope.failModal();
});
 })(rolesName,userId);

})/*End of loop*/

 }/*End of condition*/
 else{
  $scope.successModal();
}

 /*End of process roles add*/


/*Start of user roles add*/
if($scope.userRolesInsert.length>0)
{

angular.forEach($scope.userRolesInsert,function(val,key){

  var rolesName=val.id;
  var userId=$scope.emp.employeeId;

  /*Stat of http post*/
    (function(rolesName,userId){
console.log(rolesName+" "+userId);
    var settings = {
  "async": true,
  "crossDomain": true,
  "url":"/actnow-claims-1.0.0/actnow/employees/roles/"+rolesName+"/"+userId+"",
  "method": "PUT",
  "headers": {
    "content-type": "application/json",
    "cache-control": "no-cache",
    
  }
}

$.ajax(settings).done(function (jqXHR, textStatus, errorThrown) {
  console.log("User ROles "+jqXHR);
  console.log("User ROles "+textStatus);
  console.log("User ROles "+errorThrown);
  $scope.successModal();
}).fail(function(jqXHR, textStatus, errorThrown){
  console.log("User ROles "+jqXHR);
  console.log("User ROles "+textStatus);
  console.log("User ROles "+errorThrown);
   $scope.failModal();
});
 })(rolesName,userId);

})/*End of loop*/

 }/*End of condition*/
 else{
  $scope.successModal();
}

 /*End of User roles add*/


        /*End of loop for process*/
       }
      // console.log($scope.empGetData);
        

    }, function myError(response) {
        console.log(response.data);
         $scope.failModal();
                       
    });
              /*End of check daa present no*/
    },   
       /*maIN SUCCESS END HERE*/
     function myError(response) {
      console.log(response);
       $scope.failModal();
       //  alert("Failed t insert EMployee"+response)

       
    });     










$scope.successModal=function(){
  console.log($scope.count);
  --$scope.count;
if($scope.count==0)
{
  $("#loading").css("display","none");
   window.parent.moveTop();
            $(".modal-body-result").html("<div class='alert alert-success'> <strong> Submission successfully</strong></div>");
                    $("#myModal3").modal();
                      
                       $(".clo-message").on("click",function(){
                         window.parent.closeModal();
                       })
}

}
$scope.failModal=function(){


        $("#loading").css("display","none");
         window.parent.moveTop();
           $(".modal-body-result").html("<div class='alert alert-danger'> <strong> Submission Failed</div>");
                    $("#myModal3").modal();

                       $(".clo-message").on("click",function(){
                         window.parent.closeModal();
                       })
}














}
/*ENd of sub*/


    
  })/*End of controller*/

/*Email validation start*/
.directive('country', function ($q, $timeout,$http) {
        return {
            require: 'ngModel',
            link: function (scope, element, attributes, control) {
                // temporary data from local variable
            //    var countryNames = ['India', 'USA', 'Canada'];
                control.$asyncValidators.country = function (modelValue, viewValue) {
                    if (control.$isEmpty(modelValue)) {
                        return $q.when();
                    }
                    
                    var defer = $q.defer();

                    // to imitate the behavior of service access
                    // In real time, fire $http and get value then validate
                  /*  $timeout(function () {
                        if (countryNames.indexOf(modelValue) === -1) // not found
                        {
                            defer.resolve(); // wow, this country available
                        }
                        else
                        {
                            defer.reject();
                        }
                    }, 1000);*/

var tempArr=[];
                    $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"
    }).then(function mySuccess(response) {

      angular.forEach(response.data,function(value,key){

        var email=value.emailId;
        tempArr.push(email);

        
       });/*End of loop*/
console.log(tempArr);
 if (tempArr.indexOf(modelValue) === -1) // not found
                        {

                            defer.resolve(); // wow, this country available
                        }
                        else
                        {
                            defer.reject();
                            console.log("success");
                        }
      })
      
                   // console.log(modelValue+"    "+viewValue);

                    return defer.promise;
                };
            }
        };
    })
                  
 /*Email validation end*/



 /*User validation start*/
.directive('countr', function ($q, $timeout,$http) {
        return {
            require: 'ngModel',
            link: function (scope, element, attributes, control) {
                // temporary data from local variable
            //    var countryNames = ['India', 'USA', 'Canada'];
                control.$asyncValidators.countr = function (modelValue, viewValue) {
                    if (control.$isEmpty(modelValue)) {
                        return $q.when();
                    }
                    
                    console.log(modelValue);
                    var defer = $q.defer();

                    // to imitate the behavior of service access
                    // In real time, fire $http and get value then validate
                  /*  $timeout(function () {
                        if (countryNames.indexOf(modelValue) === -1) // not found
                        {
                            defer.resolve(); // wow, this country available
                        }
                        else
                        {
                            defer.reject();
                        }
                    }, 1000);*/

var tempArr=[];
console.log("INSIDE");
                    $http({
        method : "GET",
        url : " /actnow-claims-1.0.0/actnow/employees/"
    }).then(function mySuccess(response) {

      angular.forEach(response.data,function(value,key){

        var loginId=value.loginId;
        tempArr.push(loginId);

        
       });/*End of loop*/
console.log(tempArr);
 if (tempArr.indexOf(modelValue) === -1) // not found
                        {

                            defer.resolve(); // wow, this country available
                        }
                        else
                        {
                            defer.reject();
                            console.log("success");
                        }
      })
      
                   // console.log(modelValue+"    "+viewValue);

                    return defer.promise;
                };
            }
        };
    })
                  
  

    .directive('onlyLettersInput', function(){

      return {
        require: 'ngModel',
        link: function(scope, element, attr, ngModelCtrl) {
          function fromUser(text) {
            var transformedInput = text.replace(/[^a-zA-Z]/g, '');
            //console.log(transformedInput);
            if (transformedInput !== text) {
              ngModelCtrl.$setViewValue(transformedInput);
              ngModelCtrl.$render();
            }
            return transformedInput;
          }
          ngModelCtrl.$parsers.push(fromUser);
        }
      };

    });


 /*User validation end*/

</script>













</body>
</html>


 